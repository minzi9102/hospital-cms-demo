import{s as N}from"./request-RJdxBEMa.js";import{d as Le,r as de,Y as ke,Z as je,c as j,h as T,b as B,e as G,j as F,$ as Ie,t as ve,V as Ce,w as V,a0 as Fe,F as De,y as Me,G as Se,o as I,D as Ne,_ as We}from"./index-CeZSaKIt.js";const ge="https://placehold.co/600x400/409EFF/ffffff?text=Treatment+Image",pe=[{id:101,documentId:"mock_treat_01",treatmentNo:"ç¬¬2æ¬¡",sequence_number:2,target:"face",createdAt:"2025-01-05",duration:1.5,patient:{id:1,Name:"æ¼”ç¤ºè´¦å·"},Images:[{id:1,documentId:"img_01",url:ge,name:"demo.jpg",width:600,height:400,formats:{thumbnail:{url:ge,width:300,height:200}}}]},{id:102,documentId:"mock_treat_02",treatmentNo:"ç¬¬1æ¬¡",sequence_number:1,target:"arm",createdAt:"2024-12-20",duration:1,patient:{id:1,Name:"æ¼”ç¤ºè´¦å·"},Images:[]}],ze=[{id:1,documentId:"mock_doc_001",Name:"æ¼”ç¤ºè´¦å·",Gender:"male",Birthday:"1995-05-20",treatmentNo:"ç¬¬2æ¬¡",past_treatments:["laser"],treatments:[pe[0],pe[1]]},{id:2,documentId:"mock_doc_002",Name:"æž—æµ‹è¯•",Gender:"female",Birthday:"2000-10-01",treatmentNo:"æ— ",past_treatments:["none"],treatments:[]}],Et=r=>{{console.log("ðŸš€ [Demo Mode] getPatientList: è¿”å›žæœ¬åœ° Mock æ•°æ®");let e=[...ze];if(r?.filters?.Name?.$containsi){const t=r.filters.Name.$containsi.toLowerCase();e=e.filter(a=>a.Name.toLowerCase().includes(t))}return Promise.resolve({data:{data:e,meta:{pagination:{page:1,pageSize:10,pageCount:1,total:e.length}}}})}},At=r=>Promise.reject("æ¼”ç¤ºæ¨¡å¼ä¸æ”¯æŒåˆ é™¤æ“ä½œ"),Ot=r=>Promise.reject("æ¼”ç¤ºæ¨¡å¼ä¸æ”¯æŒåˆ›å»ºæ“ä½œ"),Pt=(r,e)=>Promise.reject("æ¼”ç¤ºæ¨¡å¼ä¸æ”¯æŒä¿®æ”¹æ“ä½œ"),He={Maxillofacial:"é¢Œé¢éƒ¨",Chest:"èƒ¸éƒ¨","Abdomen & Buttocks":"è…¹éƒ¨ä¸Žè‡€éƒ¨","Shoulder & Back":"è‚©èƒŒéƒ¨",Limbs:"å››è‚¢","Whole Body":"å…¨èº«","Multiple Sites":"å¤šéƒ¨ä½"},Lt=Object.entries(He).map(([r,e])=>({value:r,label:e})),$e={none:"æ— ",surgery:"æ‰‹æœ¯",injection:"æ³¨å°„",sr90:"é”¶90",brachytherapy:"æµ…æ”¾",laser:"æ¿€å…‰",other:"å…¶ä»–"},kt=Object.entries($e).map(([r,e])=>({value:r,label:e}));function be(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);e&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,a)}return t}function D(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?be(Object(t),!0).forEach(function(a){Xe(r,a,t[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):be(Object(t)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(t,a))})}return r}function Ge(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function ye(r,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(r,Re(a.key),a)}}function Ve(r,e,t){return e&&ye(r.prototype,e),t&&ye(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}function Xe(r,e,t){return e=Re(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function M(){return M=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(r[a]=t[a])}return r},M.apply(this,arguments)}function Ke(r,e){if(typeof r!="object"||r===null)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var a=t.call(r,e);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}function Re(r){var e=Ke(r,"string");return typeof e=="symbol"?e:String(e)}var Be={exports:{}};(function(r){typeof window>"u"||(function(e){var t=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,a=e.Blob&&(function(){try{return!!new Blob}catch{return!1}})(),i=a&&e.Uint8Array&&(function(){try{return new Blob([new Uint8Array(100)]).size===100}catch{return!1}})(),s=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,m=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,f=(a||s)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(l){var c,d,v,_,o,n,u,h,g;if(c=l.match(m),!c)throw new Error("invalid data URI");for(d=c[2]?c[1]:"text/plain"+(c[3]||";charset=US-ASCII"),v=!!c[4],_=l.slice(c[0].length),v?o=atob(_):o=decodeURIComponent(_),n=new ArrayBuffer(o.length),u=new Uint8Array(n),h=0;h<o.length;h+=1)u[h]=o.charCodeAt(h);return a?new Blob([i?u:n],{type:d}):(g=new s,g.append(n),g.getBlob(d))};e.HTMLCanvasElement&&!t.toBlob&&(t.mozGetAsFile?t.toBlob=function(l,c,d){var v=this;setTimeout(function(){d&&t.toDataURL&&f?l(f(v.toDataURL(c,d))):l(v.mozGetAsFile("blob",c))})}:t.toDataURL&&f&&(t.msToBlob?t.toBlob=function(l,c,d){var v=this;setTimeout(function(){(c&&c!=="image/png"||d)&&t.toDataURL&&f?l(f(v.toDataURL(c,d))):l(v.msToBlob(c))})}:t.toBlob=function(l,c,d){var v=this;setTimeout(function(){l(f(v.toDataURL(c,d)))})})),r.exports?r.exports=f:e.dataURLtoBlob=f})(window)})(Be);var we=Be.exports,Ye=function(e){return typeof Blob>"u"?!1:e instanceof Blob||Object.prototype.toString.call(e)==="[object Blob]"},_e={strict:!0,checkOrientation:!0,retainExif:!1,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,resize:"none",quality:.8,mimeType:"auto",convertTypes:["image/png"],convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},qe=typeof window<"u"&&typeof window.document<"u",R=qe?window:{},S=function(e){return e>0&&e<1/0},Je=Array.prototype.slice;function Y(r){return Array.from?Array.from(r):Je.call(r)}var Ze=/^image\/.+$/;function K(r){return Ze.test(r)}function Qe(r){var e=K(r)?r.substr(6):"";return e==="jpeg"&&(e="jpg"),".".concat(e)}var Ue=String.fromCharCode;function et(r,e,t){var a="",i;for(t+=e,i=e;i<t;i+=1)a+=Ue(r.getUint8(i));return a}var tt=R.btoa;function xe(r,e){for(var t=[],a=8192,i=new Uint8Array(r);i.length>0;)t.push(Ue.apply(null,Y(i.subarray(0,a)))),i=i.subarray(a);return"data:".concat(e,";base64,").concat(tt(t.join("")))}function at(r){var e=new DataView(r),t;try{var a,i,s;if(e.getUint8(0)===255&&e.getUint8(1)===216)for(var m=e.byteLength,f=2;f+1<m;){if(e.getUint8(f)===255&&e.getUint8(f+1)===225){i=f;break}f+=1}if(i){var l=i+4,c=i+10;if(et(e,l,4)==="Exif"){var d=e.getUint16(c);if(a=d===18761,(a||d===19789)&&e.getUint16(c+2,a)===42){var v=e.getUint32(c+4,a);v>=8&&(s=c+v)}}}if(s){var _=e.getUint16(s,a),o,n;for(n=0;n<_;n+=1)if(o=s+n*12+2,e.getUint16(o,a)===274){o+=8,t=e.getUint16(o,a),e.setUint16(o,1,a);break}}}catch{t=1}return t}function rt(r){var e=0,t=1,a=1;switch(r){case 2:t=-1;break;case 3:e=-180;break;case 4:a=-1;break;case 5:e=90,a=-1;break;case 6:e=90;break;case 7:e=90,t=-1;break;case 8:e=-90;break}return{rotate:e,scaleX:t,scaleY:a}}var nt=/\.\d*(?:0|9){12}\d*$/;function Te(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e11;return nt.test(r)?Math.round(r*e)/e:r}function C(r){var e=r.aspectRatio,t=r.height,a=r.width,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"none",s=S(a),m=S(t);if(s&&m){var f=t*e;(i==="contain"||i==="none")&&f>a||i==="cover"&&f<a?t=a/e:a=t*e}else s?t=a/e:m&&(a=t*e);return{width:a,height:t}}function it(r){for(var e=Y(new Uint8Array(r)),t=e.length,a=[],i=0;i+3<t;){var s=e[i],m=e[i+1];if(s===255&&m===218)break;if(s===255&&m===216)i+=2;else{var f=e[i+2]*256+e[i+3],l=i+f+2,c=e.slice(i,l);a.push(c),i=l}}return a.reduce(function(d,v){return v[0]===255&&v[1]===225?d.concat(v):d},[])}function ot(r,e){var t=Y(new Uint8Array(r));if(t[2]!==255||t[3]!==224)return r;var a=t[4]*256+t[5],i=[255,216].concat(e,t.slice(4+a));return new Uint8Array(i)}var st=R.ArrayBuffer,X=R.FileReader,U=R.URL||R.webkitURL,lt=/\.\w+$/,ct=R.Compressor,ut=(function(){function r(e,t){Ge(this,r),this.file=e,this.exif=[],this.image=new Image,this.options=D(D({},_e),t),this.aborted=!1,this.result=null,this.init()}return Ve(r,[{key:"init",value:function(){var t=this,a=this.file,i=this.options;if(!Ye(a)){this.fail(new Error("The first argument must be a File or Blob object."));return}var s=a.type;if(!K(s)){this.fail(new Error("The first argument must be an image File or Blob object."));return}if(!U||!X){this.fail(new Error("The current browser does not support image compression."));return}st||(i.checkOrientation=!1,i.retainExif=!1);var m=s==="image/jpeg",f=m&&i.checkOrientation,l=m&&i.retainExif;if(U&&!f&&!l)this.load({url:U.createObjectURL(a)});else{var c=new X;this.reader=c,c.onload=function(d){var v=d.target,_=v.result,o={},n=1;f&&(n=at(_),n>1&&M(o,rt(n))),l&&(t.exif=it(_)),f||l?!U||n>1?o.url=xe(_,s):o.url=U.createObjectURL(a):o.url=_,t.load(o)},c.onabort=function(){t.fail(new Error("Aborted to read the image with FileReader."))},c.onerror=function(){t.fail(new Error("Failed to read the image with FileReader."))},c.onloadend=function(){t.reader=null},f||l?c.readAsArrayBuffer(a):c.readAsDataURL(a)}}},{key:"load",value:function(t){var a=this,i=this.file,s=this.image;s.onload=function(){a.draw(D(D({},t),{},{naturalWidth:s.naturalWidth,naturalHeight:s.naturalHeight}))},s.onabort=function(){a.fail(new Error("Aborted to load the image."))},s.onerror=function(){a.fail(new Error("Failed to load the image."))},R.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(R.navigator.userAgent)&&(s.crossOrigin="anonymous"),s.alt=i.name,s.src=t.url}},{key:"draw",value:function(t){var a=this,i=t.naturalWidth,s=t.naturalHeight,m=t.rotate,f=m===void 0?0:m,l=t.scaleX,c=l===void 0?1:l,d=t.scaleY,v=d===void 0?1:d,_=this.file,o=this.image,n=this.options,u=document.createElement("canvas"),h=u.getContext("2d"),g=Math.abs(f)%180===90,y=(n.resize==="contain"||n.resize==="cover")&&S(n.width)&&S(n.height),w=Math.max(n.maxWidth,0)||1/0,x=Math.max(n.maxHeight,0)||1/0,O=Math.max(n.minWidth,0)||0,P=Math.max(n.minHeight,0)||0,E=i/s,p=n.width,b=n.height;if(g){var q=[x,w];w=q[0],x=q[1];var J=[P,O];O=J[0],P=J[1];var Z=[b,p];p=Z[0],b=Z[1]}y&&(E=p/b);var Q=C({aspectRatio:E,width:w,height:x},"contain");w=Q.width,x=Q.height;var ee=C({aspectRatio:E,width:O,height:P},"cover");if(O=ee.width,P=ee.height,y){var te=C({aspectRatio:E,width:p,height:b},n.resize);p=te.width,b=te.height}else{var ae=C({aspectRatio:E,width:p,height:b}),re=ae.width;p=re===void 0?i:re;var ne=ae.height;b=ne===void 0?s:ne}p=Math.floor(Te(Math.min(Math.max(p,O),w))),b=Math.floor(Te(Math.min(Math.max(b,P),x)));var Ee=-p/2,Ae=-b/2,Oe=p,Pe=b,W=[];if(y){var ie=0,oe=0,z=i,H=s,se=C({aspectRatio:E,width:i,height:s},{contain:"cover",cover:"contain"}[n.resize]);z=se.width,H=se.height,ie=(i-z)/2,oe=(s-H)/2,W.push(ie,oe,z,H)}if(W.push(Ee,Ae,Oe,Pe),g){var le=[b,p];p=le[0],b=le[1]}u.width=p,u.height=b,K(n.mimeType)||(n.mimeType=_.type);var ce="transparent";_.size>n.convertSize&&n.convertTypes.indexOf(n.mimeType)>=0&&(n.mimeType="image/jpeg");var ue=n.mimeType==="image/jpeg";if(ue&&(ce="#fff"),h.fillStyle=ce,h.fillRect(0,0,p,b),n.beforeDraw&&n.beforeDraw.call(this,h,u),!this.aborted&&(h.save(),h.translate(p/2,b/2),h.rotate(f*Math.PI/180),h.scale(c,v),h.drawImage.apply(h,[o].concat(W)),h.restore(),n.drew&&n.drew.call(this,h,u),!this.aborted)){var he=function(L){if(!a.aborted){var fe=function(k){return a.done({naturalWidth:i,naturalHeight:s,result:k})};if(L&&ue&&n.retainExif&&a.exif&&a.exif.length>0){var me=function(k){return fe(we(xe(ot(k,a.exif),n.mimeType)))};if(L.arrayBuffer)L.arrayBuffer().then(me).catch(function(){a.fail(new Error("Failed to read the compressed image with Blob.arrayBuffer()."))});else{var A=new X;a.reader=A,A.onload=function($){var k=$.target;me(k.result)},A.onabort=function(){a.fail(new Error("Aborted to read the compressed image with FileReader."))},A.onerror=function(){a.fail(new Error("Failed to read the compressed image with FileReader."))},A.onloadend=function(){a.reader=null},A.readAsArrayBuffer(L)}}else fe(L)}};u.toBlob?u.toBlob(he,n.mimeType,n.quality):he(we(u.toDataURL(n.mimeType,n.quality)))}}},{key:"done",value:function(t){var a=t.naturalWidth,i=t.naturalHeight,s=t.result,m=this.file,f=this.image,l=this.options;if(U&&f.src.indexOf("blob:")===0&&U.revokeObjectURL(f.src),s)if(l.strict&&!l.retainExif&&s.size>m.size&&l.mimeType===m.type&&!(l.width>a||l.height>i||l.minWidth>a||l.minHeight>i||l.maxWidth<a||l.maxHeight<i))s=m;else{var c=new Date;s.lastModified=c.getTime(),s.lastModifiedDate=c,s.name=m.name,s.name&&s.type!==m.type&&(s.name=s.name.replace(lt,Qe(s.type)))}else s=m;this.result=s,l.success&&l.success.call(this,s)}},{key:"fail",value:function(t){var a=this.options;if(a.error)a.error.call(this,t);else throw t}},{key:"abort",value:function(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}}],[{key:"noConflict",value:function(){return window.Compressor=ct,r}},{key:"setDefaults",value:function(t){M(_e,t)}}]),r})();const ht=async r=>{const e=new FormData;e.append("files",r);const t=await N.post("/upload",e),a=Array.isArray(t)?t:t?.data;if(Array.isArray(a)&&a.length>0)return a[0];throw console.error("ä¸Šä¼ å“åº”å¼‚å¸¸:",t),new Error("å›¾ç‰‡ä¸Šä¼ å¤±è´¥ï¼šæ— æ³•è§£æžæœåŠ¡å™¨è¿”å›žçš„æ•°æ®")},ft={class:"custom-uploader"},mt={key:0,class:"main-preview-area"},dt={class:"image-stage"},vt=["src"],gt={class:"action-bar"},pt={class:"counter"},bt={key:1,class:"empty-placeholder"},yt={class:"thumbnail-strip"},wt=["onClick"],_t=["src"],xt={class:"add-btn"},Tt=Le({__name:"index",setup(r,{expose:e}){const t=de([]),a=de(0),i=ke(()=>t.value[a.value]),s=(o,n,u)=>new Promise(h=>{const g=document.createElement("canvas"),y=g.getContext("2d"),w=Math.abs(n)%180!==0;g.width=w?o.naturalHeight:o.naturalWidth,g.height=w?o.naturalWidth:o.naturalHeight,y.fillStyle="#fff",y.fillRect(0,0,g.width,g.height),y.translate(g.width/2,g.height/2),y.rotate(n*Math.PI/180),y.drawImage(o,-o.naturalWidth/2,-o.naturalHeight/2),g.toBlob(x=>{x&&h(new File([x],u,{type:"image/jpeg"}))},"image/jpeg",.9)}),m=o=>new Promise((n,u)=>{const h=new Image,g=URL.createObjectURL(o);h.onload=()=>{n(h)},h.onerror=u,h.src=g}),f=o=>new Promise((n,u)=>{new ut(o,{quality:1,checkOrientation:!0,mimeType:"image/jpeg",success(h){n(new File([h],o.name,{type:"image/jpeg"}))},error:u})}),l=async(o,n)=>{const u=o.raw;if(!u)return;const h=n.indexOf(o);h!==-1&&n.splice(h,1);try{console.log(`ðŸ“¸ [å¤„ç†å¼€å§‹] æ–‡ä»¶: ${o.name}`);const g=await f(u),y=await m(g),w=await s(y,0,o.name);console.log(`âœ… [é‡ç»˜å®Œæˆ] æœ€ç»ˆä¸Šä¼ æ–‡ä»¶å¤§å°: ${(w.size/1024).toFixed(2)}KB`),t.value.push({uid:o.uid,raw:w,url:URL.createObjectURL(w),name:o.name}),URL.revokeObjectURL(y.src),a.value=t.value.length-1}catch(g){console.error("å›¾ç‰‡é¢„å¤„ç†å¤±è´¥",g)}},c=async()=>{const o=i.value;if(!o)return;const n=o.url;try{const u=await m(o.raw),h=await s(u,90,o.name);o.raw=h,o.url=URL.createObjectURL(h),URL.revokeObjectURL(n),URL.revokeObjectURL(u.src)}catch(u){console.error("æ—‹è½¬å¤±è´¥",u)}},d=()=>{const o=i.value;o&&(URL.revokeObjectURL(o.url),t.value.splice(a.value,1),t.value.length===0?a.value=0:a.value>=t.value.length&&(a.value=t.value.length-1))},v=o=>{a.value=o};return e({submitAll:async()=>{if(t.value.length===0)return[];console.log("ðŸš€ [æ‰¹é‡ä¸Šä¼ ] å¼€å§‹...");const o=t.value.map(async n=>{try{const u=await ht(n.raw);return console.log(`âœ… å›¾ç‰‡ ${n.name} ä¸Šä¼ æˆåŠŸ ID: ${u.id}`),u.id}catch(u){throw console.error(`âŒ æ–‡ä»¶ ${n.name} ä¸Šä¼ å¤±è´¥`,u),u}});return await Promise.all(o)},hasFiles:()=>t.value.length>0}),je(()=>{t.value.forEach(o=>URL.revokeObjectURL(o.url))}),(o,n)=>{const u=G("el-button"),h=G("el-icon"),g=G("el-upload");return I(),j("div",ft,[i.value?(I(),j("div",mt,[T("div",dt,[T("img",{src:i.value.url,alt:"preview"},null,8,vt)]),T("div",gt,[B(u,{type:"warning",icon:F(Ie),circle:"",onClick:c,size:"large"},null,8,["icon"]),T("span",pt,ve(a.value+1)+" / "+ve(t.value.length),1),B(u,{type:"danger",icon:F(Ce),circle:"",onClick:d,size:"large"},null,8,["icon"])])])):(I(),j("div",bt,[B(h,{size:40,color:"#909399"},{default:V(()=>[B(F(Fe))]),_:1}),n[0]||(n[0]=T("p",null,"ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ‹æ‘„æˆ–é€‰æ‹©ç…§ç‰‡",-1))])),T("div",yt,[(I(!0),j(De,null,Me(t.value,(y,w)=>(I(),j("div",{key:y.uid,class:Ne(["thumb-item",{active:w===a.value}]),onClick:x=>v(w)},[T("img",{src:y.url},null,8,_t)],10,wt))),128)),B(g,{action:"#","auto-upload":!1,"show-file-list":!1,multiple:"",accept:"image/*","on-change":l,class:"add-btn-wrapper"},{default:V(()=>[T("div",xt,[B(h,null,{default:V(()=>[B(F(Se))]),_:1})])]),_:1})])])}}}),jt=We(Tt,[["__scopeId","data-v-ae52ee34"]]),It=r=>N.get("/treatments",{params:{...r,populate:["patient","Images"]}}),Ct=r=>N.delete(`/treatments/${r}`),Ft=r=>N.post("/treatments",{data:r});export{jt as I,$e as P,Lt as T,He as a,kt as b,Ft as c,Ot as d,At as e,It as f,Et as g,Ct as h,Pt as u};
