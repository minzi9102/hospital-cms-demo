import{d as ae,r as p,a as R,v as le,c,b as a,w as l,e as s,h as b,M as ne,f as oe,j as f,O as se,G as re,g as u,Q as ie,P as de,i as h,t as _,z as ue,V as pe,F as $,y as L,E as S,q as ce,o as r,_ as me}from"./index-CEobTKSS.js";import{f as ge,a as fe,T as _e,I as ve,g as ye,c as be,h as he}from"./treatment-B7XT94iX.js";import"./request-C1PgLj7X.js";const ke={class:"app-container"},Ve={class:"filter-container"},xe={class:"left"},we={class:"right"},Ce={key:0,style:{display:"flex","align-items":"center"}},Ne={key:0,style:{"font-size":"12px",color:"#909399"}},Ie={key:1,style:{color:"#dcdfe6"}},Te={key:0},Se={key:1,class:"text-gray-300"},ze={class:"pagination-container"},Ue=ae({__name:"index",setup(qe){const M="http://192.168.1.111:1337",z=p([]),V=p(!1),U=p(0),i=R({page:1,pageSize:10,treatmentNo:""}),v=p(!1),x=p(!1),w=p(),C=p(null),B=_e,N=p(!1),k=p([]),o=R({patient:"",target:"",sequence_number:void 0,duration:0}),O={patient:[{required:!0,message:"è¯·é€‰æ‹©å…³è”æ‚£è€…",trigger:"change"}],target:[{required:!0,message:"è¯·é€‰æ‹©æ²»ç–—éƒ¨ä½",trigger:"change"}]},q=n=>{if(!n||!n.url)return"";const e=n.formats?.thumbnail?.url||n.url;return e.startsWith("http")?e:`${M}${e}`},g=async()=>{V.value=!0;try{const n={"pagination[page]":i.page,"pagination[pageSize]":i.pageSize,populate:["patient","Images"],sort:"createdAt:desc"};i.treatmentNo&&(n["filters[treatmentNo][$contains]"]=i.treatmentNo);const e=await ge(n);e.data&&(z.value=e.data.data||e.data||[],U.value=e.data.meta?.pagination?.total||e.meta?.pagination?.total||0)}catch(n){console.error(n)}finally{V.value=!1}},G=async n=>{if(n){N.value=!0;try{const e=await ye({"filters[Name][$contains]":n,"pagination[limit]":10});k.value=e.data?.data||e.data||[]}catch(e){console.error(e)}finally{N.value=!1}}else k.value=[]},F=()=>{o.patient="",o.target="",o.sequence_number=void 0,k.value=[],v.value=!0},K=async()=>{w.value&&await w.value.validate(async n=>{if(n){x.value=!0;try{let e=[];C.value&&(e=await C.value.submitAll());const d={patient:o.patient,target:o.target,sequence_number:o.sequence_number,duration:o.duration,Images:e};console.log("ğŸ“¡ æäº¤ Payload:",d),await be(d),S.success("åˆ›å»ºæˆåŠŸ"),v.value=!1,g()}catch(e){console.error(e);const d=e.response?.data?.error?.message||"åˆ›å»ºå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–é‡è¯•";S.error(d)}finally{x.value=!1}}})},j=n=>{ce.confirm("ç¡®å®šåˆ é™¤å—?","è­¦å‘Š",{type:"warning"}).then(async()=>{await he(n.documentId),S.success("åˆ é™¤æˆåŠŸ"),g()})},I=()=>{i.page=1,g()},Q=n=>{i.page=n,g()};return le(()=>{g()}),(n,e)=>{const d=s("el-button"),W=s("el-input"),T=s("el-tag"),m=s("el-table-column"),H=s("el-image"),J=s("el-table"),X=s("el-pagination"),Y=s("el-card"),A=s("el-option"),D=s("el-select"),y=s("el-form-item"),E=s("el-input-number"),Z=s("el-form"),ee=s("el-dialog"),te=de("loading");return r(),c("div",ke,[a(Y,{shadow:"never"},{default:l(()=>[b("div",Ve,[b("div",xe,[a(W,{modelValue:i.treatmentNo,"onUpdate:modelValue":e[0]||(e[0]=t=>i.treatmentNo=t),placeholder:"æœç´¢æ²»ç–—ç¼–å·...",class:"search-input",clearable:"",onClear:I,onKeyup:oe(I,["enter"])},{append:l(()=>[a(d,{icon:f(se),onClick:I},null,8,["icon"])]),_:1},8,["modelValue"])]),b("div",we,[a(d,{type:"primary",icon:f(re),onClick:F},{default:l(()=>[...e[9]||(e[9]=[u("æ–°å»ºè®°å½•",-1)])]),_:1},8,["icon"]),a(d,{icon:f(ie),circle:"",onClick:g},null,8,["icon"])])]),ne((r(),h(J,{data:z.value,border:"",style:{"margin-top":"20px"}},{default:l(()=>[a(m,{prop:"treatmentNo",label:"ç¼–å·",width:"120"},{default:l(({row:t})=>[a(T,null,{default:l(()=>[u(_(t.treatmentNo),1)]),_:2},1024)]),_:1}),a(m,{label:"å½±åƒèµ„æ–™",width:"120"},{default:l(({row:t})=>[t.Images&&t.Images.length>0?(r(),c("div",Ce,[a(H,{style:{width:"40px",height:"40px","border-radius":"4px","margin-right":"5px"},src:q(t.Images[0]),"preview-src-list":t.Images.map(P=>q(P).replace("thumbnail_","")),"preview-teleported":"",fit:"cover"},null,8,["src","preview-src-list"]),t.Images.length>1?(r(),c("span",Ne,"+"+_(t.Images.length-1),1)):ue("",!0)])):(r(),c("span",Ie,"-"))]),_:1}),a(m,{label:"å…³è”æ‚£è€…",width:"150"},{default:l(({row:t})=>[t.patient?(r(),c("span",Te,_(t.patient.Name),1)):(r(),h(T,{key:1,type:"warning"},{default:l(()=>[...e[10]||(e[10]=[u("æ— å…³è”",-1)])]),_:1}))]),_:1}),a(m,{label:"éƒ¨ä½"},{default:l(({row:t})=>[u(_(f(fe)[t.target]||t.target),1)]),_:1}),a(m,{label:"æ—¶é•¿",width:"100",align:"center"},{default:l(({row:t})=>[t.duration?(r(),h(T,{key:0,type:"info",effect:"plain"},{default:l(()=>[u(_(t.duration)+" å°æ—¶ ",1)]),_:2},1024)):(r(),c("span",Se,"-"))]),_:1}),a(m,{prop:"createdAt",label:"åˆ›å»ºæ—¶é—´"},{default:l(({row:t})=>[u(_(new Date(t.createdAt).toLocaleString()),1)]),_:1}),a(m,{label:"æ“ä½œ",fixed:"right",width:"100"},{default:l(({row:t})=>[a(d,{link:"",type:"danger",icon:f(pe),onClick:P=>j(t)},{default:l(()=>[...e[11]||(e[11]=[u("åˆ é™¤",-1)])]),_:1},8,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[te,V.value]]),b("div",ze,[a(X,{"current-page":i.page,"onUpdate:currentPage":e[1]||(e[1]=t=>i.page=t),"page-size":i.pageSize,"onUpdate:pageSize":e[2]||(e[2]=t=>i.pageSize=t),total:U.value,layout:"total, prev, pager, next",onCurrentChange:Q},null,8,["current-page","page-size","total"])])]),_:1}),a(ee,{modelValue:v.value,"onUpdate:modelValue":e[8]||(e[8]=t=>v.value=t),title:"æ–°å»ºæ²»ç–—è®°å½•",width:"600px","close-on-click-modal":!1,"destroy-on-close":""},{footer:l(()=>[a(d,{onClick:e[7]||(e[7]=t=>v.value=!1)},{default:l(()=>[...e[14]||(e[14]=[u("å–æ¶ˆ",-1)])]),_:1}),a(d,{type:"primary",loading:x.value,onClick:K},{default:l(()=>[...e[15]||(e[15]=[u("ç¡®å®šåˆ›å»º",-1)])]),_:1},8,["loading"])]),default:l(()=>[a(Z,{ref_key:"formRef",ref:w,model:o,rules:O,"label-width":"100px"},{default:l(()=>[a(y,{label:"é€‰æ‹©æ‚£è€…",prop:"patient"},{default:l(()=>[a(D,{modelValue:o.patient,"onUpdate:modelValue":e[3]||(e[3]=t=>o.patient=t),filterable:"",remote:"","reserve-keyword":"",placeholder:"è¯·è¾“å…¥æ‚£è€…å§“åæœç´¢","remote-method":G,loading:N.value,style:{width:"100%"}},{default:l(()=>[(r(!0),c($,null,L(k.value,t=>(r(),h(A,{key:t.id,label:`${t.Name} (${t.Gender==="male"?"ç”·":"å¥³"})`,value:t.documentId},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),a(y,{label:"æ²»ç–—éƒ¨ä½",prop:"target"},{default:l(()=>[a(D,{modelValue:o.target,"onUpdate:modelValue":e[4]||(e[4]=t=>o.target=t),placeholder:"è¯·é€‰æ‹©",style:{width:"100%"}},{default:l(()=>[(r(!0),c($,null,L(f(B),t=>(r(),h(A,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(y,{label:"æ²»ç–—æ—¶é•¿",prop:"duration"},{default:l(()=>[a(E,{modelValue:o.duration,"onUpdate:modelValue":e[5]||(e[5]=t=>o.duration=t),min:0,step:5,"controls-position":"right",style:{width:"100%"}},{suffix:l(()=>[...e[12]||(e[12]=[u("å°æ—¶",-1)])]),_:1},8,["modelValue"])]),_:1}),a(y,{label:"æ²»ç–—å½±åƒ"},{default:l(()=>[a(ve,{ref_key:"uploaderRef",ref:C,limit:10},null,512)]),_:1}),a(y,{label:"æ‰‹åŠ¨åºå·",prop:"sequence_number"},{default:l(()=>[a(E,{modelValue:o.sequence_number,"onUpdate:modelValue":e[6]||(e[6]=t=>o.sequence_number=t),min:1,placeholder:"ç•™ç©ºè‡ªåŠ¨ç”Ÿæˆ",style:{width:"100%"}},null,8,["modelValue"]),e[13]||(e[13]=b("div",{style:{"font-size":"12px",color:"#999","margin-top":"5px","line-height":"1.2"}}," é€šå¸¸æ— éœ€å¡«å†™ã€‚ ",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Pe=me(Ue,[["__scopeId","data-v-984f4f81"]]);export{Pe as default};
