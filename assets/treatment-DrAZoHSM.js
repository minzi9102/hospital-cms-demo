import{s as z}from"./request-CRSYU9Kc.js";import{d as Pe,r as ve,Y as Le,Z as je,c as k,h as R,b as B,e as V,j as D,$ as ke,t as ge,V as Ie,w as X,a0 as Ce,F as Fe,y as De,G as Me,o as I,D as Se,_ as We}from"./index-BPmDnSba.js";const C="https://placehold.co/600x400/409EFF/ffffff?text=Treatment+Image",ze=[{id:1,documentId:"demo_001",Name:"æ¼”ç¤ºè´¦å·",Gender:"male",Birthday:"1995-05-20",past_treatments:["laser"],treatments:[{id:101,documentId:"t_001",treatmentNo:"ç¬¬1æ¬¡",sequence_number:1,target:"face",createdAt:"2025-01-01",duration:1.5,Images:[{id:1,documentId:"img_001",name:"demo.jpg",url:C,width:600,height:400,formats:{thumbnail:{url:C,width:300,height:200},small:{url:C,width:300,height:200},medium:{url:C,width:300,height:200},large:{url:C,width:300,height:200}}}]}]},{id:2,documentId:"demo_002",Name:"å¼ ä¸‰ (ç¤ºä¾‹)",Gender:"female",Birthday:"2000-10-01",past_treatments:["none"],treatments:[]}],Ut=r=>{{console.log("ðŸš€ [Demo Mode] getPatientList: è¿”å›žæœ¬åœ° Mock æ•°æ®");let e=[...ze];if(r?.filters?.Name?.$containsi){const t=r.filters.Name.$containsi.toLowerCase();e=e.filter(a=>a.Name.toLowerCase().includes(t))}return Promise.resolve({data:{data:e,meta:{pagination:{page:1,pageSize:10,pageCount:1,total:e.length}}}})}},Et=r=>Promise.reject("æ¼”ç¤ºæ¨¡å¼ä¸æ”¯æŒåˆ é™¤æ“ä½œ"),At=r=>Promise.reject("æ¼”ç¤ºæ¨¡å¼ä¸æ”¯æŒåˆ›å»ºæ“ä½œ"),Ot=(r,e)=>Promise.reject("æ¼”ç¤ºæ¨¡å¼ä¸æ”¯æŒä¿®æ”¹æ“ä½œ"),He={Maxillofacial:"é¢Œé¢éƒ¨",Chest:"èƒ¸éƒ¨","Abdomen & Buttocks":"è…¹éƒ¨ä¸Žè‡€éƒ¨","Shoulder & Back":"è‚©èƒŒéƒ¨",Limbs:"å››è‚¢","Whole Body":"å…¨èº«","Multiple Sites":"å¤šéƒ¨ä½"},Pt=Object.entries(He).map(([r,e])=>({value:r,label:e})),Ne={none:"æ— ",surgery:"æ‰‹æœ¯",injection:"æ³¨å°„",sr90:"é”¶90",brachytherapy:"æµ…æ”¾",laser:"æ¿€å…‰",other:"å…¶ä»–"},Lt=Object.entries(Ne).map(([r,e])=>({value:r,label:e}));function pe(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);e&&(a=a.filter(function(n){return Object.getOwnPropertyDescriptor(r,n).enumerable})),t.push.apply(t,a)}return t}function M(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?pe(Object(t),!0).forEach(function(a){Ve(r,a,t[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):pe(Object(t)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(t,a))})}return r}function $e(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function be(r,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(r,Re(a.key),a)}}function Ge(r,e,t){return e&&be(r.prototype,e),t&&be(r,t),Object.defineProperty(r,"prototype",{writable:!1}),r}function Ve(r,e,t){return e=Re(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function S(){return S=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(r[a]=t[a])}return r},S.apply(this,arguments)}function Xe(r,e){if(typeof r!="object"||r===null)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var a=t.call(r,e);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}function Re(r){var e=Xe(r,"string");return typeof e=="symbol"?e:String(e)}var Te={exports:{}};(function(r){typeof window>"u"||(function(e){var t=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,a=e.Blob&&(function(){try{return!!new Blob}catch{return!1}})(),n=a&&e.Uint8Array&&(function(){try{return new Blob([new Uint8Array(100)]).size===100}catch{return!1}})(),s=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,m=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,f=(a||s)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(l){var c,d,v,x,o,i,u,h,g;if(c=l.match(m),!c)throw new Error("invalid data URI");for(d=c[2]?c[1]:"text/plain"+(c[3]||";charset=US-ASCII"),v=!!c[4],x=l.slice(c[0].length),v?o=atob(x):o=decodeURIComponent(x),i=new ArrayBuffer(o.length),u=new Uint8Array(i),h=0;h<o.length;h+=1)u[h]=o.charCodeAt(h);return a?new Blob([n?u:i],{type:d}):(g=new s,g.append(i),g.getBlob(d))};e.HTMLCanvasElement&&!t.toBlob&&(t.mozGetAsFile?t.toBlob=function(l,c,d){var v=this;setTimeout(function(){d&&t.toDataURL&&f?l(f(v.toDataURL(c,d))):l(v.mozGetAsFile("blob",c))})}:t.toDataURL&&f&&(t.msToBlob?t.toBlob=function(l,c,d){var v=this;setTimeout(function(){(c&&c!=="image/png"||d)&&t.toDataURL&&f?l(f(v.toDataURL(c,d))):l(v.msToBlob(c))})}:t.toBlob=function(l,c,d){var v=this;setTimeout(function(){l(f(v.toDataURL(c,d)))})})),r.exports?r.exports=f:e.dataURLtoBlob=f})(window)})(Te);var ye=Te.exports,Ye=function(e){return typeof Blob>"u"?!1:e instanceof Blob||Object.prototype.toString.call(e)==="[object Blob]"},we={strict:!0,checkOrientation:!0,retainExif:!1,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,resize:"none",quality:.8,mimeType:"auto",convertTypes:["image/png"],convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},Ke=typeof window<"u"&&typeof window.document<"u",T=Ke?window:{},W=function(e){return e>0&&e<1/0},qe=Array.prototype.slice;function q(r){return Array.from?Array.from(r):qe.call(r)}var Je=/^image\/.+$/;function K(r){return Je.test(r)}function Ze(r){var e=K(r)?r.substr(6):"";return e==="jpeg"&&(e="jpg"),".".concat(e)}var Be=String.fromCharCode;function Qe(r,e,t){var a="",n;for(t+=e,n=e;n<t;n+=1)a+=Be(r.getUint8(n));return a}var et=T.btoa;function xe(r,e){for(var t=[],a=8192,n=new Uint8Array(r);n.length>0;)t.push(Be.apply(null,q(n.subarray(0,a)))),n=n.subarray(a);return"data:".concat(e,";base64,").concat(et(t.join("")))}function tt(r){var e=new DataView(r),t;try{var a,n,s;if(e.getUint8(0)===255&&e.getUint8(1)===216)for(var m=e.byteLength,f=2;f+1<m;){if(e.getUint8(f)===255&&e.getUint8(f+1)===225){n=f;break}f+=1}if(n){var l=n+4,c=n+10;if(Qe(e,l,4)==="Exif"){var d=e.getUint16(c);if(a=d===18761,(a||d===19789)&&e.getUint16(c+2,a)===42){var v=e.getUint32(c+4,a);v>=8&&(s=c+v)}}}if(s){var x=e.getUint16(s,a),o,i;for(i=0;i<x;i+=1)if(o=s+i*12+2,e.getUint16(o,a)===274){o+=8,t=e.getUint16(o,a),e.setUint16(o,1,a);break}}}catch{t=1}return t}function at(r){var e=0,t=1,a=1;switch(r){case 2:t=-1;break;case 3:e=-180;break;case 4:a=-1;break;case 5:e=90,a=-1;break;case 6:e=90;break;case 7:e=90,t=-1;break;case 8:e=-90;break}return{rotate:e,scaleX:t,scaleY:a}}var rt=/\.\d*(?:0|9){12}\d*$/;function _e(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e11;return rt.test(r)?Math.round(r*e)/e:r}function F(r){var e=r.aspectRatio,t=r.height,a=r.width,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"none",s=W(a),m=W(t);if(s&&m){var f=t*e;(n==="contain"||n==="none")&&f>a||n==="cover"&&f<a?t=a/e:a=t*e}else s?t=a/e:m&&(a=t*e);return{width:a,height:t}}function it(r){for(var e=q(new Uint8Array(r)),t=e.length,a=[],n=0;n+3<t;){var s=e[n],m=e[n+1];if(s===255&&m===218)break;if(s===255&&m===216)n+=2;else{var f=e[n+2]*256+e[n+3],l=n+f+2,c=e.slice(n,l);a.push(c),n=l}}return a.reduce(function(d,v){return v[0]===255&&v[1]===225?d.concat(v):d},[])}function nt(r,e){var t=q(new Uint8Array(r));if(t[2]!==255||t[3]!==224)return r;var a=t[4]*256+t[5],n=[255,216].concat(e,t.slice(4+a));return new Uint8Array(n)}var ot=T.ArrayBuffer,Y=T.FileReader,U=T.URL||T.webkitURL,st=/\.\w+$/,lt=T.Compressor,ct=(function(){function r(e,t){$e(this,r),this.file=e,this.exif=[],this.image=new Image,this.options=M(M({},we),t),this.aborted=!1,this.result=null,this.init()}return Ge(r,[{key:"init",value:function(){var t=this,a=this.file,n=this.options;if(!Ye(a)){this.fail(new Error("The first argument must be a File or Blob object."));return}var s=a.type;if(!K(s)){this.fail(new Error("The first argument must be an image File or Blob object."));return}if(!U||!Y){this.fail(new Error("The current browser does not support image compression."));return}ot||(n.checkOrientation=!1,n.retainExif=!1);var m=s==="image/jpeg",f=m&&n.checkOrientation,l=m&&n.retainExif;if(U&&!f&&!l)this.load({url:U.createObjectURL(a)});else{var c=new Y;this.reader=c,c.onload=function(d){var v=d.target,x=v.result,o={},i=1;f&&(i=tt(x),i>1&&S(o,at(i))),l&&(t.exif=it(x)),f||l?!U||i>1?o.url=xe(x,s):o.url=U.createObjectURL(a):o.url=x,t.load(o)},c.onabort=function(){t.fail(new Error("Aborted to read the image with FileReader."))},c.onerror=function(){t.fail(new Error("Failed to read the image with FileReader."))},c.onloadend=function(){t.reader=null},f||l?c.readAsArrayBuffer(a):c.readAsDataURL(a)}}},{key:"load",value:function(t){var a=this,n=this.file,s=this.image;s.onload=function(){a.draw(M(M({},t),{},{naturalWidth:s.naturalWidth,naturalHeight:s.naturalHeight}))},s.onabort=function(){a.fail(new Error("Aborted to load the image."))},s.onerror=function(){a.fail(new Error("Failed to load the image."))},T.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(T.navigator.userAgent)&&(s.crossOrigin="anonymous"),s.alt=n.name,s.src=t.url}},{key:"draw",value:function(t){var a=this,n=t.naturalWidth,s=t.naturalHeight,m=t.rotate,f=m===void 0?0:m,l=t.scaleX,c=l===void 0?1:l,d=t.scaleY,v=d===void 0?1:d,x=this.file,o=this.image,i=this.options,u=document.createElement("canvas"),h=u.getContext("2d"),g=Math.abs(f)%180===90,y=(i.resize==="contain"||i.resize==="cover")&&W(i.width)&&W(i.height),w=Math.max(i.maxWidth,0)||1/0,_=Math.max(i.maxHeight,0)||1/0,O=Math.max(i.minWidth,0)||0,P=Math.max(i.minHeight,0)||0,E=n/s,p=i.width,b=i.height;if(g){var J=[_,w];w=J[0],_=J[1];var Z=[P,O];O=Z[0],P=Z[1];var Q=[b,p];p=Q[0],b=Q[1]}y&&(E=p/b);var ee=F({aspectRatio:E,width:w,height:_},"contain");w=ee.width,_=ee.height;var te=F({aspectRatio:E,width:O,height:P},"cover");if(O=te.width,P=te.height,y){var ae=F({aspectRatio:E,width:p,height:b},i.resize);p=ae.width,b=ae.height}else{var re=F({aspectRatio:E,width:p,height:b}),ie=re.width;p=ie===void 0?n:ie;var ne=re.height;b=ne===void 0?s:ne}p=Math.floor(_e(Math.min(Math.max(p,O),w))),b=Math.floor(_e(Math.min(Math.max(b,P),_)));var Ue=-p/2,Ee=-b/2,Ae=p,Oe=b,H=[];if(y){var oe=0,se=0,N=n,$=s,le=F({aspectRatio:E,width:n,height:s},{contain:"cover",cover:"contain"}[i.resize]);N=le.width,$=le.height,oe=(n-N)/2,se=(s-$)/2,H.push(oe,se,N,$)}if(H.push(Ue,Ee,Ae,Oe),g){var ce=[b,p];p=ce[0],b=ce[1]}u.width=p,u.height=b,K(i.mimeType)||(i.mimeType=x.type);var ue="transparent";x.size>i.convertSize&&i.convertTypes.indexOf(i.mimeType)>=0&&(i.mimeType="image/jpeg");var he=i.mimeType==="image/jpeg";if(he&&(ue="#fff"),h.fillStyle=ue,h.fillRect(0,0,p,b),i.beforeDraw&&i.beforeDraw.call(this,h,u),!this.aborted&&(h.save(),h.translate(p/2,b/2),h.rotate(f*Math.PI/180),h.scale(c,v),h.drawImage.apply(h,[o].concat(H)),h.restore(),i.drew&&i.drew.call(this,h,u),!this.aborted)){var fe=function(L){if(!a.aborted){var me=function(j){return a.done({naturalWidth:n,naturalHeight:s,result:j})};if(L&&he&&i.retainExif&&a.exif&&a.exif.length>0){var de=function(j){return me(ye(xe(nt(j,a.exif),i.mimeType)))};if(L.arrayBuffer)L.arrayBuffer().then(de).catch(function(){a.fail(new Error("Failed to read the compressed image with Blob.arrayBuffer()."))});else{var A=new Y;a.reader=A,A.onload=function(G){var j=G.target;de(j.result)},A.onabort=function(){a.fail(new Error("Aborted to read the compressed image with FileReader."))},A.onerror=function(){a.fail(new Error("Failed to read the compressed image with FileReader."))},A.onloadend=function(){a.reader=null},A.readAsArrayBuffer(L)}}else me(L)}};u.toBlob?u.toBlob(fe,i.mimeType,i.quality):fe(ye(u.toDataURL(i.mimeType,i.quality)))}}},{key:"done",value:function(t){var a=t.naturalWidth,n=t.naturalHeight,s=t.result,m=this.file,f=this.image,l=this.options;if(U&&f.src.indexOf("blob:")===0&&U.revokeObjectURL(f.src),s)if(l.strict&&!l.retainExif&&s.size>m.size&&l.mimeType===m.type&&!(l.width>a||l.height>n||l.minWidth>a||l.minHeight>n||l.maxWidth<a||l.maxHeight<n))s=m;else{var c=new Date;s.lastModified=c.getTime(),s.lastModifiedDate=c,s.name=m.name,s.name&&s.type!==m.type&&(s.name=s.name.replace(st,Ze(s.type)))}else s=m;this.result=s,l.success&&l.success.call(this,s)}},{key:"fail",value:function(t){var a=this.options;if(a.error)a.error.call(this,t);else throw t}},{key:"abort",value:function(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}}],[{key:"noConflict",value:function(){return window.Compressor=lt,r}},{key:"setDefaults",value:function(t){S(we,t)}}]),r})();const ut=async r=>{const e=new FormData;e.append("files",r);const t=await z.post("/upload",e),a=Array.isArray(t)?t:t?.data;if(Array.isArray(a)&&a.length>0)return a[0];throw console.error("ä¸Šä¼ å“åº”å¼‚å¸¸:",t),new Error("å›¾ç‰‡ä¸Šä¼ å¤±è´¥ï¼šæ— æ³•è§£æžæœåŠ¡å™¨è¿”å›žçš„æ•°æ®")},ht={class:"custom-uploader"},ft={key:0,class:"main-preview-area"},mt={class:"image-stage"},dt=["src"],vt={class:"action-bar"},gt={class:"counter"},pt={key:1,class:"empty-placeholder"},bt={class:"thumbnail-strip"},yt=["onClick"],wt=["src"],xt={class:"add-btn"},_t=Pe({__name:"index",setup(r,{expose:e}){const t=ve([]),a=ve(0),n=Le(()=>t.value[a.value]),s=(o,i,u)=>new Promise(h=>{const g=document.createElement("canvas"),y=g.getContext("2d"),w=Math.abs(i)%180!==0;g.width=w?o.naturalHeight:o.naturalWidth,g.height=w?o.naturalWidth:o.naturalHeight,y.fillStyle="#fff",y.fillRect(0,0,g.width,g.height),y.translate(g.width/2,g.height/2),y.rotate(i*Math.PI/180),y.drawImage(o,-o.naturalWidth/2,-o.naturalHeight/2),g.toBlob(_=>{_&&h(new File([_],u,{type:"image/jpeg"}))},"image/jpeg",.9)}),m=o=>new Promise((i,u)=>{const h=new Image,g=URL.createObjectURL(o);h.onload=()=>{i(h)},h.onerror=u,h.src=g}),f=o=>new Promise((i,u)=>{new ct(o,{quality:1,checkOrientation:!0,mimeType:"image/jpeg",success(h){i(new File([h],o.name,{type:"image/jpeg"}))},error:u})}),l=async(o,i)=>{const u=o.raw;if(!u)return;const h=i.indexOf(o);h!==-1&&i.splice(h,1);try{console.log(`ðŸ“¸ [å¤„ç†å¼€å§‹] æ–‡ä»¶: ${o.name}`);const g=await f(u),y=await m(g),w=await s(y,0,o.name);console.log(`âœ… [é‡ç»˜å®Œæˆ] æœ€ç»ˆä¸Šä¼ æ–‡ä»¶å¤§å°: ${(w.size/1024).toFixed(2)}KB`),t.value.push({uid:o.uid,raw:w,url:URL.createObjectURL(w),name:o.name}),URL.revokeObjectURL(y.src),a.value=t.value.length-1}catch(g){console.error("å›¾ç‰‡é¢„å¤„ç†å¤±è´¥",g)}},c=async()=>{const o=n.value;if(!o)return;const i=o.url;try{const u=await m(o.raw),h=await s(u,90,o.name);o.raw=h,o.url=URL.createObjectURL(h),URL.revokeObjectURL(i),URL.revokeObjectURL(u.src)}catch(u){console.error("æ—‹è½¬å¤±è´¥",u)}},d=()=>{const o=n.value;o&&(URL.revokeObjectURL(o.url),t.value.splice(a.value,1),t.value.length===0?a.value=0:a.value>=t.value.length&&(a.value=t.value.length-1))},v=o=>{a.value=o};return e({submitAll:async()=>{if(t.value.length===0)return[];console.log("ðŸš€ [æ‰¹é‡ä¸Šä¼ ] å¼€å§‹...");const o=t.value.map(async i=>{try{const u=await ut(i.raw);return console.log(`âœ… å›¾ç‰‡ ${i.name} ä¸Šä¼ æˆåŠŸ ID: ${u.id}`),u.id}catch(u){throw console.error(`âŒ æ–‡ä»¶ ${i.name} ä¸Šä¼ å¤±è´¥`,u),u}});return await Promise.all(o)},hasFiles:()=>t.value.length>0}),je(()=>{t.value.forEach(o=>URL.revokeObjectURL(o.url))}),(o,i)=>{const u=V("el-button"),h=V("el-icon"),g=V("el-upload");return I(),k("div",ht,[n.value?(I(),k("div",ft,[R("div",mt,[R("img",{src:n.value.url,alt:"preview"},null,8,dt)]),R("div",vt,[B(u,{type:"warning",icon:D(ke),circle:"",onClick:c,size:"large"},null,8,["icon"]),R("span",gt,ge(a.value+1)+" / "+ge(t.value.length),1),B(u,{type:"danger",icon:D(Ie),circle:"",onClick:d,size:"large"},null,8,["icon"])])])):(I(),k("div",pt,[B(h,{size:40,color:"#909399"},{default:X(()=>[B(D(Ce))]),_:1}),i[0]||(i[0]=R("p",null,"ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ‹æ‘„æˆ–é€‰æ‹©ç…§ç‰‡",-1))])),R("div",bt,[(I(!0),k(Fe,null,De(t.value,(y,w)=>(I(),k("div",{key:y.uid,class:Se(["thumb-item",{active:w===a.value}]),onClick:_=>v(w)},[R("img",{src:y.url},null,8,wt)],10,yt))),128)),B(g,{action:"#","auto-upload":!1,"show-file-list":!1,multiple:"",accept:"image/*","on-change":l,class:"add-btn-wrapper"},{default:X(()=>[R("div",xt,[B(h,null,{default:X(()=>[B(D(Me))]),_:1})])]),_:1})])])}}}),jt=We(_t,[["__scopeId","data-v-ae52ee34"]]),kt=r=>z.get("/treatments",{params:{...r,populate:["patient","Images"]}}),It=r=>z.delete(`/treatments/${r}`),Ct=r=>z.post("/treatments",{data:r});export{jt as I,Ne as P,Pt as T,He as a,Lt as b,Ct as c,At as d,Et as e,kt as f,Ut as g,It as h,Ot as u};
